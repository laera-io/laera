# Development

* [Dependencies](#dependencies)
  * [Flutter](#flutter)
  * [Automatization](#automatization)
  * [Android](#android)
  * [After Installation](#after-installation)
* [Routine](#routine)
  * [Test & Lint](#test--lint)
  * [Autogenerated Code](#autogenerated-code)
  * [Build App Icons](#build-app-icons)
  * [Build APK](#build-apk)
* [Upgrade Flutter Version](#upgrade-flutter-version)

## Dependencies

### Flutter

* Install `flutter` from [the official install page][flutter_installation].

### Automatization

* Install `task` utility, [instruction][go_task_installation] (for example `snap install task --classic` via snap).

### Android

* Install Java 11 JDK dev package (for example `dnf install java-11-openjdk-devel` in Fedora 36);
* Set `JAVA_HOME` environment variable to those SDK (for example `/usr/lib/jvm/java-11` in Fedora 36);
* Install Android SDK via `sdkmanager` (or entire Android Studio if you need it):
  * Download `commandlinetools-<platform>-<build>_latest.zip` file from [Android Studio download page][android_studio_download];
  * Unzip it and place content of the `cmdline-tools` (`bin` and `lib`) like `<your_path>/cmdline-tools/tools/bin` and `<your_path>/cmdline-tools/tools/lib` (for example `$HOME/android/cmdline-tools/tools`);
  * Add path to the `bin` directory to the `PATH` variable (for example add line `export PATH="$HOME/android/cmdline-tools/tools/bin:$PATH"` to the `.zshrc` file);
  * Add path to the Android platform tools that will be installed later (for example add line `export PATH="$HOME/android/platform-tools:$PATH"` to the `.zshrc` file);
  * Set variable `ANDROID_HOME` (for example add line `export ANDROID_HOME="$HOME/android"` to the `~/.zshrc` file);
  * Add plugdev group to your use to be able to run on the devices:
    * Create plugdev group by running `groupadd plugdev`;
    * Add your user to this group by running `usermod -aG plugdev $LOGNAME`;
    * Log out and log in back;
  * Run `sdkmanager "platform-tools" "platforms;android-31" "build-tools;31.0.0" "system-images;android-31;default;x86_64"` and accept all licenses;
  * Accept remaining licenses by running `flutter doctor --android-licenses`.

### After Installation

* Make sure `flutter doctor` command output has no red sections;
* Make sure that everything else is fine by running `task` command.

## Routine

### Test & Lint

Before every `git commit` and `git push` especially run default target:

```sh
task
```

Default target builds app, run lint and tests. For lint only run:

```sh
task lint
```

For tests only run:

```sh
task test
```

### Autogenerated Code

> All files ended with `.g.dart` are autogenerated.

To regenerate all `.g.dart` files:

```sh
task generate
```

### Build App Icons

Change `assets/icon/logo.png` and then:

```sh
task generate-icon
```

### Build APK

To build not singed dev APK run:

```sh
task build
```

The result will be at `build/app/outputs/flutter-apk/app-debug.apk`.

## Upgrade Flutter Version

* Update Flutter and Dart SDK versions at `pubspec.yaml`;
* Update dependencies `flutter pub upgrade`;
* Update Flutter version in all CI/CD pipelines at `.github/workflows/`, env variable `FLUTTER_VERSION`.

[flutter_installation]: https://docs.flutter.dev/get-started/install
[go_task_installation]: https://taskfile.dev/installation/
[android_studio_download]: https://developer.android.com/studio
