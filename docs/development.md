# Development

* [Dependencies](#dependencies)
  * [Flutter](#flutter)
  * [Automatization](#automatization)
  * [Android](#android)
  * [Ruby (optional)](#ruby-optional)
  * [After Installation](#after-installation)
* [Routine](#routine)
  * [Test & Lint](#test--lint)
  * [Autogenerated Code](#autogenerated-code)
  * [Build App Icons](#build-app-icons)
  * [Build APK](#build-apk)
* [Upgrade Flutter Version](#upgrade-flutter-version)

## Dependencies

### Flutter

* Install `flutter` from [the official install page][flutter_installation].

### Automatization

* Install `make` utility.

### Android

* Install Java 11 JDK dev package (for example `dnf install java-11-openjdk-devel` in Fedora 36);
* Set `JAVA_HOME` environment variable to those SDK (for example `/usr/lib/jvm/java-11` in Fedora 36);
* Install Android SDK via `sdkmanager` (or entire Android Studio if you need it):
  * Download `commandlinetools-<platform>-<build>_latest.zip` file from [Android Studio download page][android_studio_download];
  * Unzip it and place content of the `cmdline-tools` (`bin` and `lib`) like `<your_path>/cmdline-tools/tools/bin` and `<your_path>/cmdline-tools/tools/lib` (for example `$HOME/android/cmdline-tools/tools`);
  * Add path to the `bin` directory to the `PATH` variable (for example add line `export PATH="$HOME/android/cmdline-tools/tools/bin:$PATH"` to the `.zshrc` file);
  * Add path to the Android platform tools that will be installed later (for example add line `export PATH="$HOME/android/platform-tools:$PATH"` to the `.zshrc` file);
  * Set variable `ANDROID_HOME` (for example add line `export ANDROID_HOME="$HOME/android"` to the `~/.zshrc` file);
  * Add plugdev group to your use to be able to run on the devices:
    * Create plugdev group by running `groupadd plugdev`;
    * Add your user to this group by running `usermod -aG plugdev $LOGNAME`;
    * Log out and log in back;
  * Run `sdkmanager "platform-tools" "platforms;android-31" "build-tools;31.0.0" "system-images;android-31;default;x86_64"` and accept all licenses;
  * Accept remaining licenses by running `flutter doctor --android-licenses`.

### Ruby (optional)

> It's only needed by building tool `Fastlane` that is used in CI/CD. So you don't need to install all of this until some local debug stuff.

* Install `ruby 3` dev package and `gem` (for example `dnf install ruby-devel rubygems` in Fedora 36);
* Install `g++` needed by some ruby dependencies (for example `dnf install gcc-c++` in Fedora 36);
* Install gem file dependencies by calling `make deps-ruby` in the project root directory.

### After Installation

* Make sure `flutter doctor` command output has no red sections;
* Make sure that everything else is fine by running `make` command;
* Dart and Flutter analytics may be optionally disabled by calling `make disable-analytics`.

## Routine

### Test & Lint

Before every `git commit` and `git push` especially run default target:

```sh
make
```

Default target builds app, run lint and tests. For lint only run:

```sh
make lint
```

For tests only run:

```sh
make test
```

### Autogenerated Code

> All files ended with `.g.dart` are autogenerated.

To regenerate all `.g.dart` files:

```sh
make generate
```

### Build App Icons

Change `assets/icon/logo.png` and then:

```sh
make icon
```

### Build APK

```sh
make build-apk-dev
```

The result will be at `build/app/outputs/flutter-apk/app-debug.apk`.

## Upgrade Flutter Version

* Update Flutter and Dart SDK versions at `pubspec.yaml`;
* Update dependencies `flutter pub upgrade`;
* Update Flutter version in all CI/CD pipelines at `.github/workflows/`, env variable `FLUTTER_VERSION`.

[flutter_installation]: https://docs.flutter.dev/get-started/install
[android_studio_download]: https://developer.android.com/studio
